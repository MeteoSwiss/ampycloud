<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using ampycloud &mdash; ampycloud  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The ampycloud scientific parameters" href="parameters.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            ampycloud
          </a>
              <div class="version">
                2.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using ampycloud</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#a-no-words-example-for-those-that-want-to-get-started-quickly">A no-words example for those that want to get started quickly</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-input-data">The input data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-algorithm">Running the algorithm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-ampycloud-core-run-function">The <code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.core.run()</span></code> function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-ampycloud-data-ceilochunk-class">The <code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk</span></code> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-no-plots-required-shortcut">The no-plots-required shortcut</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adjusting-the-default-algorithm-parameters">Adjusting the default algorithm parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plotting-the-diagnostic-diagram">Plotting the diagnostic diagram</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adjusting-the-plotting-style">Adjusting the plotting style</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">The ampycloud scientific parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledge.html">Acknowledging ampycloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License &amp; Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Scientific changes since v2.0.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/MeteoSwiss/ampycloud/blob/develop/CONTRIBUTING.md">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/MeteoSwiss/ampycloud">Github repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ampycloud</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Using ampycloud</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/running.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-ampycloud">
<span id="using"></span><h1>Using ampycloud<a class="headerlink" href="#using-ampycloud" title="Link to this heading"></a></h1>
<section id="a-no-words-example-for-those-that-want-to-get-started-quickly">
<h2>A no-words example for those that want to get started quickly<a class="headerlink" href="#a-no-words-example-for-those-that-want-to-get-started-quickly" title="Link to this heading"></a></h2>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">ampycloud</span>
<span class="kn">from</span> <span class="nn">ampycloud.utils</span> <span class="kn">import</span> <span class="n">mocker</span>
<span class="kn">from</span> <span class="nn">ampycloud.plots</span> <span class="kn">import</span> <span class="n">diagnostic</span>

<span class="c1"># Generate the canonical demo dataset for ampycloud</span>
<span class="c1"># Your data should have *exactly* this structure</span>
<span class="n">mock_data</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">canonical_demo_data</span><span class="p">()</span>

<span class="c1"># Run the ampycloud algorithm on it, setting the MSA to 10&#39;000 ft aal</span>
<span class="n">chunk</span> <span class="o">=</span> <span class="n">ampycloud</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">mock_data</span><span class="p">,</span> <span class="n">prms</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;MSA&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">},</span>
                      <span class="n">geoloc</span><span class="o">=</span><span class="s1">&#39;Mock data&#39;</span><span class="p">,</span> <span class="n">ref_dt</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

<span class="c1"># Get the resulting METAR message</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">metar_msg</span><span class="p">())</span>

<span class="c1"># Display the full information available for the layers found</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span>

<span class="c1"># And for the most motivated, plot the diagnostic diagram</span>
<span class="n">diagnostic</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">upto</span><span class="o">=</span><span class="s1">&#39;layers&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_stem</span><span class="o">=</span><span class="s1">&#39;ampycloud_demo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-input-data">
<h2>The input data<a class="headerlink" href="#the-input-data" title="Link to this heading"></a></h2>
<p>The ampycloud algorithm is meant to process cloud base <em>hits</em> derived from ceilometer observations.
A given set of hits to be processed by the ampycloud package must be stored inside a
<code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with a specific set of characteristics outlined below. Users can use
the following utility function to check whether a given <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> meets all the
requirements of ampycloud.</p>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.utils.</span></span><span class="sig-name descname"><span class="pre">check_data_consistency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">req_cols</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span></dt>
<dd><p>Assesses whether a given <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> is compatible with the requirements
of ampycloud.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pdf</strong> (<em>pd.DataFrame</em>) – the data to check.</p></li>
<li><p><strong>req_cols</strong> (<em>dict</em>) – A dictionary in which keys correspond to the required columns, and their
value are the column type. Defaults to None = the ampycloud requirements.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>pd.DataFrame</em> – the data, possibly cleaned-up of superfluous columns, and with corrected
dtypes.</p>
</dd>
</dl>
<p>This function will raise an <a class="reference internal" href="modules/ampycloud.html#ampycloud.errors.AmpycloudError" title="ampycloud.errors.AmpycloudError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.errors.AmpycloudError</span></code></a> and/or
an <a class="reference internal" href="modules/ampycloud.html#ampycloud.errors.AmpycloudWarning" title="ampycloud.errors.AmpycloudWarning"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.errors.AmpycloudWarning</span></code></a> if it identifies very bad and/or very weird
things in <code class="docutils literal notranslate"><span class="pre">pdf</span></code>.</p>
<p>Specifically, the input <code class="docutils literal notranslate"><span class="pre">pdf</span></code> must be a <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with the following
column names/types (formally defined in <a class="reference internal" href="modules/ampycloud.html#ampycloud.hardcoded.REQ_DATA_COLS" title="ampycloud.hardcoded.REQ_DATA_COLS"><code class="xref py py-data docutils literal notranslate"><span class="pre">ampycloud.hardcoded.REQ_DATA_COLS</span></code></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ceilo&#39;</span><span class="o">/</span><span class="n">pd</span><span class="o">.</span><span class="n">StringDtype</span><span class="p">(),</span> <span class="s1">&#39;dt&#39;</span><span class="o">/</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="o">/</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="o">/</span><span class="nb">int</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ceilo</span></code> column contains the names/ids of the ceilometers as <code class="docutils literal notranslate"><span class="pre">pd.StringDtype()</span></code>.
See the pandas
<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.StringDtype.html">documentation</a>
for more info about this type.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dt</span></code> column contains time deltas, in seconds, between a given ceilometer
observation and <code class="docutils literal notranslate"><span class="pre">ref_dt</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">obs_time-ref_dt</span></code>). Ideally, <code class="docutils literal notranslate"><span class="pre">ref_dt</span></code> would be the issuing
time of the METAR message, such that <code class="docutils literal notranslate"><span class="pre">dt</span></code> values are negative, with the smallest one
corresponding to the oldest measurement.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">height</span></code> column contains the cloud base hit heights reported by the ceilometers, in ft
above aerodrome level.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> column contains integers that correspond to the hit <em>sequence id</em>. If a given
ceilometer is reporting multiple hits for a given timestep (corresponding to a cloud level 1,
cloud level 2, cloud level 3, etc …), the <code class="docutils literal notranslate"><span class="pre">type</span></code> of these measurements would be <code class="docutils literal notranslate"><span class="pre">1</span></code>,
<code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span></code>, etc … Any data point with a <code class="docutils literal notranslate"><span class="pre">type</span></code> of <code class="docutils literal notranslate"><span class="pre">-1</span></code> will be flagged in the ampycloud
plots as a vertical Visibility (VV) hit, <strong>but it will not be treated any differently than any
other regular hit</strong>. Type <code class="docutils literal notranslate"><span class="pre">0</span></code> corresponds to no (cloud) detection, in which case the
corresponding hit height should be a NaN.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A <strong>non-detection</strong> corresponds to a valid measurement with a <code class="docutils literal notranslate"><span class="pre">dt</span></code> value, a <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">0</span></code>,
and <code class="docutils literal notranslate"><span class="pre">NaN</span></code> as the height. It should not be confused with a <strong>non-observation</strong>,
when no data was acquired at all !</p>
</div>
<p>If it all sounds confusing, it is possible to obtain an example of the required data format
from the <a class="reference internal" href="modules/ampycloud.utils.html#ampycloud.utils.mocker.canonical_demo_data" title="ampycloud.utils.mocker.canonical_demo_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">utils.mocker.canonical_demo_data()</span></code></a> routine of the package, like so:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ampycloud.utils</span> <span class="kn">import</span> <span class="n">mocker</span>
<span class="n">mock_data</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">canonical_demo_data</span><span class="p">()</span>
</pre></div>
</div>
<p>As mentionned above, it is also possible to verify if a given <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> is
meeting the ampycloud requirements ahead of time via
<a class="reference internal" href="modules/ampycloud.utils.html#ampycloud.utils.utils.check_data_consistency" title="ampycloud.utils.utils.check_data_consistency"><code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.utils.utils.check_data_consistency()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ampycloud.utils.utils</span> <span class="kn">import</span> <span class="n">check_data_consistency</span>
<span class="n">checked_pdf</span> <span class="o">=</span> <span class="n">check_data_consistency</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
</pre></div>
</div>
<p>This will raise an <a class="reference internal" href="modules/ampycloud.html#ampycloud.errors.AmpycloudError" title="ampycloud.errors.AmpycloudError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.errors.AmpycloudError</span></code></a> if:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> is not a <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> is missing a required column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> has a length of 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> has duplicated rows.</p></li>
<li><p>any time step for any ceilometer corresponds to both a type 0 (no hit) and not 0 (some
hit)</p></li>
<li><p>any time step for any ceilometer corresponds to both a type -1 (VV hit) and not -1 (some
hit/no hit)</p></li>
</ul>
</div></blockquote>
<p>The latter check implies that ampycloud cannot be fed a VV hit in parallel to a cloud base hit.
Should a specific ceilometer return VV hits in parallel to cloud base hits, it is up to the user
to decide whether to feed one or the other.</p>
<p>In addition, this will raise an <a class="reference internal" href="modules/ampycloud.html#ampycloud.errors.AmpycloudWarning" title="ampycloud.errors.AmpycloudWarning"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.errors.AmpycloudWarning</span></code></a> if:</p>
<blockquote>
<div><ul class="simple">
<li><p>any of <code class="docutils literal notranslate"><span class="pre">pdf</span></code> column type is not as expected. Note that in this case, the code will try
to correct the type on the fly.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> has any superfluous columns. In this case, the code will drop them automatically.</p></li>
<li><p>Any hit height is negative.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">0</span></code> hit has a non-NaN height.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">1</span></code> hit has a NaN height.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">2</span></code> hit does not have a coincident <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">1</span></code> hit.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">3</span></code> hit does not have a coincident <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">2</span></code> hit.</p></li>
</ul>
</div></blockquote>
</dd></dl>

</section>
<section id="running-the-algorithm">
<span id="running"></span><h2>Running the algorithm<a class="headerlink" href="#running-the-algorithm" title="Link to this heading"></a></h2>
<section id="the-ampycloud-core-run-function">
<h3>The <a class="reference internal" href="modules/ampycloud.html#ampycloud.core.run" title="ampycloud.core.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.core.run()</span></code></a> function<a class="headerlink" href="#the-ampycloud-core-run-function" title="Link to this heading"></a></h3>
<p>Applying the ampycloud algorithm to a given set of ceilometer cloud base hits is done via the
following function, that is also directly accessible as <code class="docutils literal notranslate"><span class="pre">ampycloud.run()</span></code>.</p>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">ampycloud.core.</span></span><span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prms</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geoloc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_dt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">datetime</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><span class="pre">CeiloChunk</span></a></span></span></dt>
<dd><p>Runs the ampycloud algorithm on a given dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – the data to be processed, as a <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>.</p></li>
<li><p><strong>prms</strong> (<em>dict, optional</em>) – a (nested) dict of parameters to adjust for this specific run.
This is meant as a thread-safe way of adjusting parameters for different runs. Any
unspecified parameter will be taken from <code class="xref py py-data docutils literal notranslate"><span class="pre">dynamic.AMPYCLOUD_PRMS</span></code> at init time.</p></li>
<li><p><strong>geoloc</strong> (<em>str, optional</em>) – the name of the geographic location where the data was taken.
Defaults to None.</p></li>
<li><p><strong>ref_dt</strong> (<em>str|datetime.datetime, optional</em>) – reference date and time of the observations,
corresponding to Delta t = 0. Defaults to None. Note that if a datetime instance
is specified, it will be turned almost immediately to str via <code class="docutils literal notranslate"><span class="pre">str(ref_dt)</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><code class="xref py py-class docutils literal notranslate"><span class="pre">data.CeiloChunk</span></code></a> – the data chunk with all the processing outcome bundled
cleanly.</p>
</dd>
</dl>
<p>All that is required to run the ampycloud algorithm is a properly
<a class="reference external" href="https://meteoswiss.github.io/ampycloud/running.html#the-input-data">formatted dataset</a>.
At the moment, specifying <code class="docutils literal notranslate"><span class="pre">geoloc</span></code> and <code class="docutils literal notranslate"><span class="pre">ref_dt</span></code> serves no purpose other than to enhance
plots (should they be created). There is no special requirements for <code class="docutils literal notranslate"><span class="pre">geoloc</span></code> and <code class="docutils literal notranslate"><span class="pre">ref_dt</span></code>:
as long as they are strings, you can set them to whatever you please.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>ampycloud treats Vertical Visibility hits no differently than any other hit. Hence, it is up
to the user to adjust the Vertical Visibility hit height (and/or ignore some of them, for
example) prior to feeding them to ampycloud, so that it can be used as a cloud hit.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>ampycloud uses the <code class="docutils literal notranslate"><span class="pre">dt</span></code> and <code class="docutils literal notranslate"><span class="pre">ceilo</span></code> values to decide if two hits are simultaenous, or
not. It is thus important that the values of <code class="docutils literal notranslate"><span class="pre">dt</span></code> be sufficiently precise to distinguish
between different measurements. Essentially, each <em>measurement</em> (which may be comprised of
several hits) should be associated to a unique <code class="docutils literal notranslate"><span class="pre">(ceilo;</span> <span class="pre">dt)</span></code> set of values. Failure to do
so may result in incorrect estimations of the cloud layer densities. See
<a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.max_hits_per_layer" title="ampycloud.data.CeiloChunk.max_hits_per_layer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data.CeiloChunk.max_hits_per_layer</span></code></a> for more details.</p>
</div>
<p>All the scientific parameters of the algorithm are set dynamically in the <a class="reference internal" href="modules/ampycloud.html#module-ampycloud.dynamic" title="ampycloud.dynamic"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dynamic</span></code></a>
module. From within a Python session all these parameters can be changed directly. For example,
to change the Minimum Sector Altitude (to be specified in ft aal), one would do:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ampycloud</span> <span class="kn">import</span> <span class="n">dynamic</span>
<span class="n">dynamic</span><span class="o">.</span><span class="n">AMPYCLOUD_PRMS</span><span class="p">[</span><span class="s1">&#39;MSA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span>
</pre></div>
</div>
<p>Alternatively, the scientific parameters can also be defined and fed to ampycloud via a YAML
file. See <a class="reference internal" href="modules/ampycloud.html#ampycloud.core.set_prms" title="ampycloud.core.set_prms"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_prms()</span></code></a> for details.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>By default, the function <a class="reference internal" href="modules/ampycloud.html#ampycloud.core.run" title="ampycloud.core.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">run()</span></code></a> will use the parameter values set in
<code class="xref py py-data docutils literal notranslate"><span class="pre">dynamic.AMPYCLOUD_PRMS</span></code>, which is not thread safe. Users interested to run
<strong>multiple concurrent ampycloud calculations with distinct sets of parameters within the
same Python session</strong> are thus urged to feed the required parameters directly to
<a class="reference internal" href="modules/ampycloud.html#ampycloud.core.run" title="ampycloud.core.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">run()</span></code></a> via the <code class="docutils literal notranslate"><span class="pre">prms</span></code> keyword argument, which expects a (nested) dictionnary
with keys compatible with <code class="xref py py-data docutils literal notranslate"><span class="pre">dynamic.AMPYCLOUD_PRMS</span></code>.</p>
<p>Examples:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define only the parameters that are non-default. To adjust the MSA, use:</span>
<span class="n">prms</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MSA&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">}</span>

<span class="c1"># Or to adjust some other algorithm parameters:</span>
<span class="n">prms</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LAYERING_PRMS&#39;</span><span class="p">:{</span><span class="s1">&#39;gmm_kwargs&#39;</span><span class="p">:{</span><span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="s1">&#39;BIC&#39;</span><span class="p">},</span> <span class="s1">&#39;min_prob&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<p>The <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><code class="xref py py-class docutils literal notranslate"><span class="pre">data.CeiloChunk</span></code></a> instance returned by this function contains all the information
associated to the ampycloud algorithm, inclduing the raw data and slicing/grouping/layering
info. Its method <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.metar_msg" title="ampycloud.data.CeiloChunk.metar_msg"><code class="xref py py-meth docutils literal notranslate"><span class="pre">data.CeiloChunk.metar_msg()</span></code></a> provides direct access to the resulting
METAR-like message. Users that require the height, okta amount, and/or exact sky coverage
fraction of layers can get them via the <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.layers" title="ampycloud.data.CeiloChunk.layers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data.CeiloChunk.layers</span></code></a> class property.</p>
<p class="rubric">Example</p>
<p>In the following example, we create the canonical mock dataset of ampycloud, run
the algorithm on it, and fetch the resulting METAR-like message:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">ampycloud</span>
<span class="kn">from</span> <span class="nn">ampycloud.utils</span> <span class="kn">import</span> <span class="n">mocker</span>

<span class="c1"># Generate the canonical demo dataset for ampycloud</span>
<span class="n">mock_data</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">canonical_demo_data</span><span class="p">()</span>

<span class="c1"># Run the ampycloud algorithm on it, setting the MSA to 10&#39;000 ft aal.</span>
<span class="n">chunk</span> <span class="o">=</span> <span class="n">ampycloud</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">mock_data</span><span class="p">,</span> <span class="n">prms</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;MSA&#39;</span><span class="p">:</span><span class="mi">10000</span><span class="p">},</span>
                      <span class="n">geoloc</span><span class="o">=</span><span class="s1">&#39;Mock data&#39;</span><span class="p">,</span> <span class="n">ref_dt</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

<span class="c1"># Get the resulting METAR message</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">metar_msg</span><span class="p">())</span>

<span class="c1"># Display the full information available for the layers found</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="the-ampycloud-data-ceilochunk-class">
<h3>The <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk</span></code></a> class<a class="headerlink" href="#the-ampycloud-data-ceilochunk-class" title="Link to this heading"></a></h3>
<p>The function <a class="reference internal" href="modules/ampycloud.html#ampycloud.core.run" title="ampycloud.core.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.core.run()</span></code></a> returns a <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk</span></code></a> class
instance, which is at the core of ampycloud. This class is used to load and format the
user-supplied data, execute the different ampycloud algorithm steps, and format their outcomes.</p>
<p>The properties of the slices/groups/layers identified by the different steps of the ampycloud
algorithm are accessible, as <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> instances, via the class properties
<a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.slices" title="ampycloud.data.CeiloChunk.slices"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk.slices</span></code></a>, <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.groups" title="ampycloud.data.CeiloChunk.groups"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk.groups</span></code></a>, and
<a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.layers" title="ampycloud.data.CeiloChunk.layers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk.layers</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.metar_msg" title="ampycloud.data.CeiloChunk.metar_msg"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk.metar_msg()</span></code></a> relies on
<a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.layers" title="ampycloud.data.CeiloChunk.layers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk.layers</span></code></a> to derive the corresponding METAR-like message.</p>
</div>
<p>All these slices/groups/layer parameters are being compiled/computed by
<a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.metarize" title="ampycloud.data.CeiloChunk.metarize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk.metarize()</span></code></a>, which contains all the info about the different
parameters.</p>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">ampycloud.data.CeiloChunk.</span></span><span class="sig-name descname"><span class="pre">metarize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">which</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'slices'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span></dt>
<dd><p>Assembles a <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> of slice/group/layer METAR properties of
interest.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>which</strong> (<em>str, optional</em>) – whether to process ‘slices’, ‘groups’, or ‘layers’.
Defaults to ‘slices’.</p>
</dd>
</dl>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> generated by this method is subsequently available via the
the appropriate class property <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.slices" title="ampycloud.data.CeiloChunk.slices"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeiloChunk.slices</span></code></a>, <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.groups" title="ampycloud.data.CeiloChunk.groups"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeiloChunk.groups</span></code></a>,
or <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk.layers" title="ampycloud.data.CeiloChunk.layers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeiloChunk.layers</span></code></a>, depending on the value of the argument <code class="docutils literal notranslate"><span class="pre">which</span></code>.</p>
<p>The slice/group/layer parameters computed/derived by this method include:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n_hits</span> <span class="pre">(int)</span></code>: duplicate-corrected number of hits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">perc</span> <span class="pre">(float)</span></code>: sky coverage percentage (between 0-100)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">okta</span> <span class="pre">(int)</span></code>: okta count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height_base</span> <span class="pre">(float)</span></code>: base height</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height_mean</span> <span class="pre">(float)</span></code>: mean height</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height_std</span> <span class="pre">(float)</span></code>: height standard deviation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height_min</span> <span class="pre">(float)</span></code>: minimum height</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height_max</span> <span class="pre">(float)</span></code>: maximum height</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thickness</span> <span class="pre">(float)</span></code>: thickness</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fluffiness</span> <span class="pre">(float)</span></code>: fluffiness (expressed in height units, i.e. ft)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">(str)</span></code>: METAR-like code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">significant</span> <span class="pre">(bool)</span></code>: whether the layer is significant according to the ICAO rules.
See <a class="reference internal" href="modules/ampycloud.html#ampycloud.icao.significant_cloud" title="ampycloud.icao.significant_cloud"><code class="xref py py-func docutils literal notranslate"><span class="pre">icao.significant_cloud()</span></code></a> for details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cluster_id</span> <span class="pre">(int)</span></code>: an ampycloud-internal identification number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isolated</span> <span class="pre">(bool)</span></code>: isolation status (for slices only)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ncomp</span> <span class="pre">(int)</span></code>: the number of subcomponents (for groups only)</p></li>
</ul>
</div></blockquote>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The value of <code class="docutils literal notranslate"><span class="pre">n_hits</span></code> is corrected for duplicate hits, to ensure a correct estimation
of the sky coverage fraction. Essentially, two (or more) <em>simultaneous hits from the
same ceilometer</em> are counted as one only. In other words, if a Type <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code> hits
<strong>from the same ceilometer, at the same observation time</strong> are included in a given
slice/group/layer, they are counted as one hit only. This is a direct consequence of the
fact that clouds have a single base height at any given time [<em>citation needed</em>].</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The metarize function is modularized in private submethods defined above.</p>
</div>
</dd></dl>

</section>
<section id="the-no-plots-required-shortcut">
<h3>The no-plots-required shortcut<a class="headerlink" href="#the-no-plots-required-shortcut" title="Link to this heading"></a></h3>
<p>The following function, also accessible as <code class="docutils literal notranslate"><span class="pre">ampycloud.metar()</span></code>,
will directly provide interested users with the ampycloud METAR-like message for a given dataset.
It is a convenience function intended for users that do not want to generate diagnostic plots, but
only seek the outcome of the ampycloud algorithm formatted as a METAR-like <code class="docutils literal notranslate"><span class="pre">str</span></code>.</p>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">ampycloud.core.</span></span><span class="sig-name descname"><span class="pre">metar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span></dt>
<dd><p>Run the ampycloud algorithm on a dataset and extract a METAR report of the cloud layers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<em>pd.DataFrame</em>) – the data to be processed, as a <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>str</em> – the METAR-like message.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ampycloud</span>
<span class="kn">from</span> <span class="nn">ampycloud.utils</span> <span class="kn">import</span> <span class="n">mocker</span>

<span class="c1"># Generate the canonical demo dataset for ampycloud</span>
<span class="n">mock_data</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">canonical_demo_data</span><span class="p">()</span>

<span class="c1"># Compute the METAR message</span>
<span class="n">msg</span> <span class="o">=</span> <span class="n">ampycloud</span><span class="o">.</span><span class="n">metar</span><span class="p">(</span><span class="n">mock_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="adjusting-the-default-algorithm-parameters">
<h3>Adjusting the default algorithm parameters<a class="headerlink" href="#adjusting-the-default-algorithm-parameters" title="Link to this heading"></a></h3>
<p>The ampycloud parameters with a <strong>scientific</strong> impact on the outcome of the algorithm
(see <a class="reference internal" href="parameters.html#the-ampycloud-scientific-parameters"><span class="std std-ref">here for the complete list</span></a>)
are accessible via <a class="reference internal" href="modules/ampycloud.html#ampycloud.dynamic.AMPYCLOUD_PRMS" title="ampycloud.dynamic.AMPYCLOUD_PRMS"><code class="xref py py-data docutils literal notranslate"><span class="pre">ampycloud.dynamic.AMPYCLOUD_PRMS</span></code></a> as a nested dictionary. When a new
<a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk</span></code></a> instance is being initiated, a copy of this nested dictionary
is being stored as an instance variable. It is then possible to adjust specific parameters via the
<code class="docutils literal notranslate"><span class="pre">prms</span></code> keyword argument when initializing a <a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk</span></code></a> instance.</p>
<p>There are thus 2+1 ways to adjust the ampycloud scientific parameters:</p>
<blockquote>
<div><ul>
<li><p><strong>1.a: Adjust them globally</strong> in <a class="reference internal" href="modules/ampycloud.html#ampycloud.dynamic.AMPYCLOUD_PRMS" title="ampycloud.dynamic.AMPYCLOUD_PRMS"><code class="xref py py-data docutils literal notranslate"><span class="pre">ampycloud.dynamic.AMPYCLOUD_PRMS</span></code></a>, like so:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ampycloud</span> <span class="kn">import</span> <span class="n">dynamic</span>

<span class="n">dynamic</span><span class="o">.</span><span class="n">AMPYCLOUD_PRMS</span><span class="p">[</span><span class="s1">&#39;MAX_HOLES_OKTA8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Always import the entire <a class="reference internal" href="modules/ampycloud.html#module-ampycloud.dynamic" title="ampycloud.dynamic"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ampycloud.dynamic</span></code></a> module and stick to the
above example structure, if the updated parameters are to be <em>seen</em> by all the ampycloud
modules.</p>
</div>
</li>
<li><p><strong>1.b: Adjust them globally</strong> via a YAML file, and <a class="reference internal" href="modules/ampycloud.html#ampycloud.core.set_prms" title="ampycloud.core.set_prms"><code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.core.set_prms()</span></code></a>. With
this approach, <a class="reference internal" href="modules/ampycloud.html#ampycloud.core.copy_prm_file" title="ampycloud.core.copy_prm_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.core.copy_prm_file()</span></code></a> can be used to obtain a local
copy of the default ampycloud parameters.</p></li>
<li><p><strong>2: Adjust them locally</strong> for a given execution of ampycloud by feeding a suitable
nested dictionary to <a class="reference internal" href="modules/ampycloud.html#ampycloud.core.run" title="ampycloud.core.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.core.run()</span></code></a> (that will create a new
<a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk</span></code></a> instance behind the scene). The dictionary, the keys
and levels of which should be consistent with <a class="reference internal" href="modules/ampycloud.html#ampycloud.dynamic.AMPYCLOUD_PRMS" title="ampycloud.dynamic.AMPYCLOUD_PRMS"><code class="xref py py-data docutils literal notranslate"><span class="pre">ampycloud.dynamic.AMPYCLOUD_PRMS</span></code></a>,
only needs to contain the specific parameters that one requires to be different from the
default values.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define only the parameters that are non-default. To adjust the MSA, use:</span>
<span class="n">my_prms</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MSA&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">}</span>

<span class="c1"># Or to adjust both the MSA and some other algorithm parameter:</span>
<span class="n">my_prms</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MSA&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="s1">&#39;GROUPING_PRMS&#39;</span><span class="p">:{</span><span class="s1">&#39;dt_scale_kwargs&#39;</span><span class="p">:{</span><span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">}}}</span>

<span class="c1"># Then feed them directly to the run call</span>
<span class="n">chunk</span> <span class="o">=</span> <span class="n">ampycloud</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">some_data_tbd</span><span class="p">,</span> <span class="n">prms</span><span class="o">=</span><span class="n">my_prms</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Options 1a and 1b are <strong>not</strong> thread-safe. Users planning to launch multiple ampycloud
processes simultaneously are urged to use option 2, if they need to set distinct parameters
between each. In case of doubts, the parameters used by a given
<a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.data.CeiloChunk</span></code></a> instance is accessible via the (parent)
<a class="reference internal" href="modules/ampycloud.html#ampycloud.data.AbstractChunk.prms" title="ampycloud.data.AbstractChunk.prms"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ampycloud.data.AbstractChunk.prms()</span></code></a> property.</p>
</div>
<p>If all hope is lost and you wish to revert to the original (default) values of all the
ampycloud scientific parameters, you can use <a class="reference internal" href="modules/ampycloud.html#ampycloud.core.reset_prms" title="ampycloud.core.reset_prms"><code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.core.reset_prms()</span></code></a>.</p>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">ampycloud.core.</span></span><span class="sig-name descname"><span class="pre">reset_prms</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">which</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span></dt>
<dd><p>Reset the ampycloud dynamic=scientific parameters to their default values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>which</strong> (<em>str|list, optional</em>) – (list of) names of parameters to reset specifically.
If not set (by default), all parameters will be reset.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ampycloud</span>
<span class="kn">from</span> <span class="nn">ampycloud</span> <span class="kn">import</span> <span class="n">dynamic</span>

<span class="c1"># Change a parameter</span>
<span class="n">dynamic</span><span class="o">.</span><span class="n">AMPYCLOUD_PRMS</span><span class="p">[</span><span class="s1">&#39;MAX_HOLES_OKTA8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># Reset them</span>
<span class="n">ampycloud</span><span class="o">.</span><span class="n">reset_prms</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Back to the default value:&#39;</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">.</span><span class="n">AMPYCLOUD_PRMS</span><span class="p">[</span><span class="s1">&#39;MAX_HOLES_OKTA8&#39;</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="logging">
<span id="id1"></span><h2>Logging<a class="headerlink" href="#logging" title="Link to this heading"></a></h2>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">logging.NullHandler</span></code> instance is being created by ampycloud, such that no logging will
be apparent to the users unless they explicitly set it up themselves
(<a class="reference external" href="https://docs.python.org/3/howto/logging.html#configuring-logging-for-a-library">see here</a> for
more details).</p>
<p>As an example, to enable ampycloud log messages all the way down to the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> level, users can
make the following call before running ampycloud functions:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;ampycloud&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Each ampycloud module has a dedicated logger based on the module <code class="docutils literal notranslate"><span class="pre">__name__</span></code>. Hence, users
can adjust the logging level of each ampycloud module however they desire, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;ampycloud.wmo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;ampycloud.scaler&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="plotting-the-diagnostic-diagram">
<span id="plotting"></span><h2>Plotting the diagnostic diagram<a class="headerlink" href="#plotting-the-diagnostic-diagram" title="Link to this heading"></a></h2>
<p>Users interested to plot the ampycloud diagnostic diagram can do using the following function,
which is also accessible as <code class="docutils literal notranslate"><span class="pre">ampycloud.plots.diagnostic()</span></code>:</p>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">ampycloud.plots.core.</span></span><span class="sig-name descname"><span class="pre">diagnostic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chunk</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="modules/ampycloud.html#ampycloud.data.CeiloChunk" title="ampycloud.data.CeiloChunk"><span class="pre">CeiloChunk</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">upto</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'layers'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_ceilos</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_metar</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_metar_origin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_stem</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_fmts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span></dt>
<dd><p>A function to create the ampycloud diagnostic plot all the way to the layering step
(included). This is the ultimate ampycloud plot that shows it all (or not - you choose !).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>chunk</strong> (<em>CeiloChunk</em>) – the CeiloChunk to look at.</p></li>
<li><p><strong>upto</strong> (<em>str, optional</em>) – up to which algorithm steps to plot. Can be one of
[‘raw_data’, ‘slices’, ‘groups’, ‘layers’]. Defaults to ‘layers’.</p></li>
<li><p><strong>show_ceilos</strong> (<em>bool, optional</em>) – if True, hits will be colored as a function of the
responsible ceilometer. Defaults to False. No effects unless <code class="docutils literal notranslate"><span class="pre">upto='raw</span> <span class="pre">data'</span></code>.</p></li>
<li><p><strong>ref_metar</strong> (<em>str, optional</em>) – reference METAR message. Defaults to None.</p></li>
<li><p><strong>ref_metar_origin</strong> (<em>str, optional</em>) – name of the source of the reference METAR set with
ref_metar. Defaults to None.</p></li>
<li><p><strong>show</strong> (<em>bool, optional</em>) – will show the plot on the screen if True. Defaults to False.</p></li>
<li><p><strong>save_stem</strong> (<em>str, optional</em>) – if set, will save the plot with this stem (which can include a
path as well). Deafults to None.</p></li>
<li><p><strong>save_fmts</strong> (<em>list|str, optional</em>) – a list of file formats to export the plot to. Defaults to
None = [‘pdf’].</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">ampycloud</span>
<span class="kn">from</span> <span class="nn">ampycloud.utils</span> <span class="kn">import</span> <span class="n">mocker</span>
<span class="kn">from</span> <span class="nn">ampycloud.plots</span> <span class="kn">import</span> <span class="n">diagnostic</span>

<span class="c1"># First create some mock data for the example</span>
<span class="n">mock_data</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">canonical_demo_data</span><span class="p">()</span>

<span class="c1"># Then run the ampycloud algorithm on it</span>
<span class="n">chunk</span> <span class="o">=</span> <span class="n">ampycloud</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">mock_data</span><span class="p">,</span> <span class="n">geoloc</span><span class="o">=</span><span class="s1">&#39;Mock data&#39;</span><span class="p">,</span> <span class="n">ref_dt</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

<span class="c1"># Create the full ampycloud diagnostic plot</span>
<span class="n">diagnostic</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">upto</span><span class="o">=</span><span class="s1">&#39;layers&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<section id="adjusting-the-plotting-style">
<h3>Adjusting the plotting style<a class="headerlink" href="#adjusting-the-plotting-style" title="Link to this heading"></a></h3>
<p>ampycloud ships with its own set of matplotlib style files, that are used in <cite>context</cite>, and thus
will not impact any user-specified setups.</p>
<p>Whereas the default parameters should ensure a decent-enough look for the diagnostic diagrams of
ampycloud, a better look can be achieved by using a system-wide LaTeX installation. Provided this is
available, users interested in creating nicer-looking diagnostic diagrams can do so by setting
the appropriate ampycloud parameter:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ampycloud</span> <span class="kn">import</span> <span class="n">dynamic</span>
<span class="n">dynamic</span><span class="o">.</span><span class="n">AMPYCLOUD_PRMS</span><span class="p">[</span><span class="s1">&#39;MPL_STYLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;latex&#39;</span>
</pre></div>
</div>
<p>And for the most demanding users that want nothing but the best, they can create plots with actual
okta symbols if they install the <a class="reference external" href="https://github.com/MeteoSwiss/metsymb">metsymb LaTeX package</a>
system-wide, and set:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ampycloud</span> <span class="kn">import</span> <span class="n">dynamic</span>
<span class="n">dynamic</span><span class="o">.</span><span class="n">AMPYCLOUD_PRMS</span><span class="p">[</span><span class="s1">&#39;MPL_STYLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;metsymb&#39;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Using a system-wide LaTeX installation to create matplotlib figures <strong>is not officially
supported by matplotib</strong>, and thus <strong>not officially supported by ampycloud</strong> either.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="parameters.html" class="btn btn-neutral float-right" title="The ampycloud scientific parameters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024, MeteoSwiss.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>