<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ampycloud.utils package &mdash; ampycloud  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="ampycloud.plots package" href="ampycloud.plots.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ampycloud
          </a>
              <div class="version">
                2.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running.html">Using ampycloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters.html">The ampycloud scientific parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledge.html">Acknowledging ampycloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License &amp; Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Scientific changes since v2.0.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/MeteoSwiss/ampycloud/blob/develop/CONTRIBUTING.md">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/MeteoSwiss/ampycloud">Github repository</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">Modules</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="ampycloud.html">ampycloud package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="ampycloud.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ampycloud.plots.html">ampycloud.plots package</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">ampycloud.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.cluster">ampycloud.cluster module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.core">ampycloud.core module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.data">ampycloud.data module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.dynamic">ampycloud.dynamic module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.errors">ampycloud.errors module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.fluffer">ampycloud.fluffer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.hardcoded">ampycloud.hardcoded module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.icao">ampycloud.icao module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.layer">ampycloud.layer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.logger">ampycloud.logger module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.scaler">ampycloud.scaler module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.version">ampycloud.version module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ampycloud.html#module-ampycloud.wmo">ampycloud.wmo module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ampycloud</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../modules.html">Modules</a></li>
          <li class="breadcrumb-item"><a href="ampycloud.html">ampycloud package</a></li>
      <li class="breadcrumb-item active">ampycloud.utils package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/modules/ampycloud.utils.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-ampycloud.utils">
<span id="ampycloud-utils-package"></span><h1>ampycloud.utils package<a class="headerlink" href="#module-ampycloud.utils" title="Link to this heading"></a></h1>
<p>Copyright (c) 2021-2022 MeteoSwiss, contributors listed in AUTHORS.</p>
<p>Distributed under the terms of the 3-Clause BSD License.</p>
<p>SPDX-License-Identifier: BSD-3-Clause</p>
<p>Module contains: ampycloud utilities</p>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-ampycloud.utils.mocker">
<span id="ampycloud-utils-mocker-module"></span><h2>ampycloud.utils.mocker module<a class="headerlink" href="#module-ampycloud.utils.mocker" title="Link to this heading"></a></h2>
<p>Copyright (c) 2021-2024 MeteoSwiss, contributors listed in AUTHORS.</p>
<p>Distributed under the terms of the 3-Clause BSD License.</p>
<p>SPDX-License-Identifier: BSD-3-Clause</p>
<p>Module contains: tools to create mock datasets</p>
<dl class="py function">
<dt class="sig sig-object py" id="ampycloud.utils.mocker.flat_layer">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.mocker.</span></span><span class="sig-name descname"><span class="pre">flat_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height_std</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sky_cov_frac</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#ampycloud.utils.mocker.flat_layer" title="Link to this definition"></a></dt>
<dd><p>Generates a mock, flat, Gaussian cloud layer around a given height.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dts</strong> (<em>np.array of float</em>) – time deltas, in s, for the simulated ceilometer hits.</p></li>
<li><p><strong>height</strong> (<em>float</em>) – layer mean height, in ft above aerodrome level (aal).</p></li>
<li><p><strong>height_std</strong> (<em>float</em>) – layer height standard deviation, in ft.</p></li>
<li><p><strong>sky_cov_frac</strong> (<em>float</em>) – Sky coverage fraction. Random hits will be set to NaN to
reach this value. Must be 0 &lt;= x &lt;= 1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> – the simulated layer with columns [‘dt’, ‘height’].</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ampycloud.utils.mocker.sin_layer">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.mocker.</span></span><span class="sig-name descname"><span class="pre">sin_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height_std</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sky_cov_frac</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amplitude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#ampycloud.utils.mocker.sin_layer" title="Link to this definition"></a></dt>
<dd><p>Generates a sinusoidal cloud layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dts</strong> (<em>np.array of float</em>) – time deltas, in s, for the simulated ceilometer hits.</p></li>
<li><p><strong>height</strong> (<em>float</em>) – layer mean height, in ft above aerodrome level (aal).</p></li>
<li><p><strong>height_std</strong> (<em>float</em>) – layer height standard deviation, in ft.</p></li>
<li><p><strong>sky_cov_frac</strong> (<em>float, optional</em>) – Sky coverage fraction. Random hits will be set to NaN to
reach this value. Must be 0 &lt;= x &lt;= 1.</p></li>
<li><p><strong>period</strong> (<em>int|float</em>) – period of the sine-wave, in s.</p></li>
<li><p><strong>amplitude</strong> (<em>int|float</em>) – amplitude of the sine-wave, in ft.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> – the simulated layer with columns [‘height’, ‘dt’].</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ampycloud.utils.mocker.mock_layers">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.mocker.</span></span><span class="sig-name descname"><span class="pre">mock_layers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_ceilos</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lookback_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hit_gap</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_prms</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#ampycloud.utils.mocker.mock_layers" title="Link to this definition"></a></dt>
<dd><p>Generate a mock set of cloud layers for a specified number of ceilometers.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul>
<li><p><strong>n_ceilos</strong> (<em>int</em>) – number of ceilometers to simulate.</p></li>
<li><p><strong>lookback_time</strong> (<em>float</em>) – length of the time interval, in s.</p></li>
<li><p><strong>hit_gap</strong> (<em>float</em>) – number of seconds between ceilometer measurements.</p></li>
<li><p><strong>layer_prms</strong> (<em>list of dict</em>) – list of layer parameters, provided as a dict for each layer.
Each dict should specify all the parameters required to generate a
<a class="reference internal" href="#ampycloud.utils.mocker.sin_layer" title="ampycloud.utils.mocker.sin_layer"><code class="xref py py-func docutils literal notranslate"><span class="pre">sin_layer()</span></code></a> (with the exception of <code class="docutils literal notranslate"><span class="pre">dts</span></code> that will be computed directly
from <code class="docutils literal notranslate"><span class="pre">lookback_time</span></code> and <code class="docutils literal notranslate"><span class="pre">hit_gap</span></code>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;height&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;height_std&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;sky_cov_frac&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="s1">&#39;period&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> – a pandas DataFrame with the mock data, ready to be fed to
ampycloud. Columns [‘ceilo’, ‘dt’, ‘height’, ‘type’] correspond to 1) ceilo names, 2) time
deltas in s, 3) hit heights in ft aal, and 4) hit type.</p>
</dd>
</dl>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<ul class="simple">
<li><p>add the possibility to set some VV hits in the mix</p></li>
<li><p>all of this could be done much more professionally with classes …</p></li>
</ul>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ampycloud.utils.mocker.canonical_demo_data">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.mocker.</span></span><span class="sig-name descname"><span class="pre">canonical_demo_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#ampycloud.utils.mocker.canonical_demo_data" title="Link to this definition"></a></dt>
<dd><p>This function creates the canonical ampycloud demonstration dataset, that can be used to
illustrate the full behavior of the algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> – the canonical mock dataset with properly-formatted columns.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-ampycloud.utils.performance">
<span id="ampycloud-utils-performance-module"></span><h2>ampycloud.utils.performance module<a class="headerlink" href="#module-ampycloud.utils.performance" title="Link to this heading"></a></h2>
<p>Copyright (c) 2021-2022 MeteoSwiss, contributors listed in AUTHORS.</p>
<p>Distributed under the terms of the 3-Clause BSD License.</p>
<p>SPDX-License-Identifier: BSD-3-Clause</p>
<p>Module contains: tools to assess the performance of ampycloud</p>
<dl class="py function">
<dt class="sig sig-object py" id="ampycloud.utils.performance.get_speed_benchmark">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.performance.</span></span><span class="sig-name descname"><span class="pre">get_speed_benchmark</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">niter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="headerlink" href="#ampycloud.utils.performance.get_speed_benchmark" title="Link to this definition"></a></dt>
<dd><p>This function will run and time <a class="reference internal" href="ampycloud.html#ampycloud.core.demo" title="ampycloud.core.demo"><code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.core.demo()</span></code></a> to assess the code’s
performance on a given machine.</p>
<p>For now, this is a rather dumb and uninspired way to do it. If the need ever arises, this
could certainly be done better, and (for example) also with a finer step resolution to see
which step (slicing, grouping, layering) is the slowest, and also separate the generation of
the mock dataset from its processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>int, float, float, float, float, float</em> – niter, mean, std, median, min, max, all in s.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-ampycloud.utils.utils">
<span id="ampycloud-utils-utils-module"></span><h2>ampycloud.utils.utils module<a class="headerlink" href="#module-ampycloud.utils.utils" title="Link to this heading"></a></h2>
<p>Copyright (c) 2022-2024 MeteoSwiss, contributors listed in AUTHORS.</p>
<p>Distributed under the terms of the 3-Clause BSD License.</p>
<p>SPDX-License-Identifier: BSD-3-Clause</p>
<p>Module contains: generic utilities</p>
<dl class="py function">
<dt class="sig sig-object py" id="ampycloud.utils.utils.check_data_consistency">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.utils.</span></span><span class="sig-name descname"><span class="pre">check_data_consistency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">req_cols</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#ampycloud.utils.utils.check_data_consistency" title="Link to this definition"></a></dt>
<dd><p>Assesses whether a given <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> is compatible with the requirements
of ampycloud.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pdf</strong> (<em>pd.DataFrame</em>) – the data to check.</p></li>
<li><p><strong>req_cols</strong> (<em>dict</em>) – A dictionary in which keys correspond to the required columns, and their
value are the column type. Defaults to None = the ampycloud requirements.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>pd.DataFrame</em> – the data, possibly cleaned-up of superfluous columns, and with corrected
dtypes.</p>
</dd>
</dl>
<p>This function will raise an <a class="reference internal" href="ampycloud.html#ampycloud.errors.AmpycloudError" title="ampycloud.errors.AmpycloudError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.errors.AmpycloudError</span></code></a> and/or
an <a class="reference internal" href="ampycloud.html#ampycloud.errors.AmpycloudWarning" title="ampycloud.errors.AmpycloudWarning"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.errors.AmpycloudWarning</span></code></a> if it identifies very bad and/or very weird
things in <code class="docutils literal notranslate"><span class="pre">pdf</span></code>.</p>
<p>Specifically, the input <code class="docutils literal notranslate"><span class="pre">pdf</span></code> must be a <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with the following
column names/types (formally defined in <a class="reference internal" href="ampycloud.html#ampycloud.hardcoded.REQ_DATA_COLS" title="ampycloud.hardcoded.REQ_DATA_COLS"><code class="xref py py-data docutils literal notranslate"><span class="pre">ampycloud.hardcoded.REQ_DATA_COLS</span></code></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ceilo&#39;</span><span class="o">/</span><span class="n">pd</span><span class="o">.</span><span class="n">StringDtype</span><span class="p">(),</span> <span class="s1">&#39;dt&#39;</span><span class="o">/</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="o">/</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="o">/</span><span class="nb">int</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ceilo</span></code> column contains the names/ids of the ceilometers as <code class="docutils literal notranslate"><span class="pre">pd.StringDtype()</span></code>.
See the pandas
<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.StringDtype.html">documentation</a>
for more info about this type.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dt</span></code> column contains time deltas, in seconds, between a given ceilometer
observation and <code class="docutils literal notranslate"><span class="pre">ref_dt</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">obs_time-ref_dt</span></code>). Ideally, <code class="docutils literal notranslate"><span class="pre">ref_dt</span></code> would be the issuing
time of the METAR message, such that <code class="docutils literal notranslate"><span class="pre">dt</span></code> values are negative, with the smallest one
corresponding to the oldest measurement.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">height</span></code> column contains the cloud base hit heights reported by the ceilometers, in ft
above aerodrome level.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> column contains integers that correspond to the hit <em>sequence id</em>. If a given
ceilometer is reporting multiple hits for a given timestep (corresponding to a cloud level 1,
cloud level 2, cloud level 3, etc …), the <code class="docutils literal notranslate"><span class="pre">type</span></code> of these measurements would be <code class="docutils literal notranslate"><span class="pre">1</span></code>,
<code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span></code>, etc … Any data point with a <code class="docutils literal notranslate"><span class="pre">type</span></code> of <code class="docutils literal notranslate"><span class="pre">-1</span></code> will be flagged in the ampycloud
plots as a vertical Visibility (VV) hit, <strong>but it will not be treated any differently than any
other regular hit</strong>. Type <code class="docutils literal notranslate"><span class="pre">0</span></code> corresponds to no (cloud) detection, in which case the
corresponding hit height should be a NaN.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A <strong>non-detection</strong> corresponds to a valid measurement with a <code class="docutils literal notranslate"><span class="pre">dt</span></code> value, a <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">0</span></code>,
and <code class="docutils literal notranslate"><span class="pre">NaN</span></code> as the height. It should not be confused with a <strong>non-observation</strong>,
when no data was acquired at all !</p>
</div>
<p>If it all sounds confusing, it is possible to obtain an example of the required data format
from the <a class="reference internal" href="#ampycloud.utils.mocker.canonical_demo_data" title="ampycloud.utils.mocker.canonical_demo_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">utils.mocker.canonical_demo_data()</span></code></a> routine of the package, like so:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ampycloud.utils</span> <span class="kn">import</span> <span class="n">mocker</span>
<span class="n">mock_data</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">canonical_demo_data</span><span class="p">()</span>
</pre></div>
</div>
<p>As mentionned above, it is also possible to verify if a given <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> is
meeting the ampycloud requirements ahead of time via
<a class="reference internal" href="#ampycloud.utils.utils.check_data_consistency" title="ampycloud.utils.utils.check_data_consistency"><code class="xref py py-func docutils literal notranslate"><span class="pre">ampycloud.utils.utils.check_data_consistency()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ampycloud.utils.utils</span> <span class="kn">import</span> <span class="n">check_data_consistency</span>
<span class="n">checked_pdf</span> <span class="o">=</span> <span class="n">check_data_consistency</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
</pre></div>
</div>
<p>This will raise an <a class="reference internal" href="ampycloud.html#ampycloud.errors.AmpycloudError" title="ampycloud.errors.AmpycloudError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.errors.AmpycloudError</span></code></a> if:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> is not a <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> is missing a required column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> has a length of 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> has duplicated rows.</p></li>
<li><p>any time step for any ceilometer corresponds to both a type 0 (no hit) and not 0 (some
hit)</p></li>
<li><p>any time step for any ceilometer corresponds to both a type -1 (VV hit) and not -1 (some
hit/no hit)</p></li>
</ul>
</div></blockquote>
<p>The latter check implies that ampycloud cannot be fed a VV hit in parallel to a cloud base hit.
Should a specific ceilometer return VV hits in parallel to cloud base hits, it is up to the user
to decide whether to feed one or the other.</p>
<p>In addition, this will raise an <a class="reference internal" href="ampycloud.html#ampycloud.errors.AmpycloudWarning" title="ampycloud.errors.AmpycloudWarning"><code class="xref py py-class docutils literal notranslate"><span class="pre">ampycloud.errors.AmpycloudWarning</span></code></a> if:</p>
<blockquote>
<div><ul class="simple">
<li><p>any of <code class="docutils literal notranslate"><span class="pre">pdf</span></code> column type is not as expected. Note that in this case, the code will try
to correct the type on the fly.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code> has any superfluous columns. In this case, the code will drop them automatically.</p></li>
<li><p>Any hit height is negative.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">0</span></code> hit has a non-NaN height.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">1</span></code> hit has a NaN height.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">2</span></code> hit does not have a coincident <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">1</span></code> hit.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">3</span></code> hit does not have a coincident <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">2</span></code> hit.</p></li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ampycloud.utils.utils.tmp_seed">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.utils.</span></span><span class="sig-name descname"><span class="pre">tmp_seed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ampycloud.utils.utils.tmp_seed" title="Link to this definition"></a></dt>
<dd><p>Temporarily reset the <code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.random.seed()</span></code> value.</p>
<p>Adapted from the reply of Paul Panzer on <a class="reference external" href="https://stackoverflow.com/questions/49555991/">SO</a>.</p>
<p>Example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">temp_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ampycloud.utils.utils.adjust_nested_dict">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.utils.</span></span><span class="sig-name descname"><span class="pre">adjust_nested_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ref_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lvls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#ampycloud.utils.utils.adjust_nested_dict" title="Link to this definition"></a></dt>
<dd><p>Update a given (nested) dictionnary given a second (possibly incomplete) one.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ref_dict</strong> (<em>dict</em>) – reference dict of dict (of dict of dict …).</p></li>
<li><p><strong>new_dict</strong> (<em>dict</em>) – values to update as a dict (of dict or dict of dict …)</p></li>
<li><p><strong>lvls</strong> (<em>list of str, optional</em>) – names of the keys of the parent nested dict layers, used
for reporting useful errors. This is used by the function itself when it calls itself.
There is no need for the user to set this to anything at first. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>dict</em> – the updated dict (of dict of dict of dict …)</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Inspired from the reply of Alex Martelli and Alex Telon on
<a class="reference external" href="https://stackoverflow.com/questions/3232943/">SO</a>.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ampycloud.utils.utils.calc_base_height">
<span class="sig-prename descclassname"><span class="pre">ampycloud.utils.utils.</span></span><span class="sig-name descname"><span class="pre">calc_base_height</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vals</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lookback_perc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height_perc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#ampycloud.utils.utils.calc_base_height" title="Link to this definition"></a></dt>
<dd><p>Calculate the layer base height.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vals</strong> (<em>npt.ArrayLike</em>) – Ceilometer hits of a given layer. Must be a flat
array/ Series of scalars and ordered in time, most recent entries last.</p></li>
<li><p><strong>lookback_perc</strong> (<em>int</em>) – Percentage of points to take into account. 100% would
correspond to all points, 50% to the recent half, etc.</p></li>
<li><p><strong>height_perc</strong> (<em>int</em>) – Percentage of points that should be neglected when calculating
the base height. Base height will be the minimum of the remaining points.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>float</em> – The layer base height.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="ampycloud.html#ampycloud.errors.AmpycloudError" title="ampycloud.errors.AmpycloudError"><strong>AmpycloudError</strong></a> – Raised if the array passed to the n_largest percentile calculation
    is empty.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ampycloud.plots.html" class="btn btn-neutral float-left" title="ampycloud.plots package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024, MeteoSwiss.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>